@using com.Bynonco.JqueryEasyUI.Core;
@using com.Bynonco.LIMS.Model;
@{
    var basicUnAuditSampleApplyURL = Url.Action("GetGridViewSampleApplyList") + "?sampleRoleStr=" + ViewData["SampleRoleStr"].ToString() + "&time=" + DateTime.Now.Millisecond.ToString();
    var userPriviliges = (UserEquipmentPrivilige)ViewData["UserPriviliges"];
    var dataGrid = Html.JDataGrid("tbSampleUnAutitList")
        .SetUrl(basicUnAuditSampleApplyURL)
        .SetHeight(580)
        .SetPageSize(com.Bynonco.LIMS.BLL.Business.Customer.Factory.CustomerFactory.GetCustomer().GetUnAuditSampleListPageSize())
        .SetShowPrintButton(false)
        .SetSortName(com.Bynonco.LIMS.BLL.Business.Customer.Factory.CustomerFactory.GetCustomer().GetUnAuditSampleListSortName())
        .SetSortOrder(SortOrder.desc)
        .SetShowSearchButton(true)
        .SetSearchScript("doShowSearch()")
        .SetShowAddButton(false).SetShowPrintButton(false);
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("编码", "Id").SetHidden(true));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("状态", "StatusName").SetHidden(true));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("状态", "Status").SetHidden(true));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("流水号", "SampleNo").SetHidden(true));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("图片", "ApplicantIcon").SetWidth(50).SetAlign(Align.center));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("送样单号", "SampleNoStr").SetWidth(295).SetAlign(Align.left));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("序号", "RowNo").SetWidth(30).SetAlign(Align.center));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("申请人", "ApplicantNameStr").SetWidth(60).SetAlign(Align.center));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("项目名称", "SampleItemName").SetWidth(180).SetAlign(Align.left));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("样品数", "Quatity").SetWidth(50).SetAlign(Align.center));
        if ((bool)ViewData["IsShowRealQuatity"])
        {
            dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("实际<br />完成样品数", "RealQuatity").SetWidth(80).SetAlign(Align.center));
            dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("实际<br />检测机时", "DurationStr").SetWidth(80).SetAlign(Align.center));
        }
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("状态", "StatusStr").SetWidth(80).SetAlign(Align.center));
        dataGrid.AddFrozenColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("收费情况", "ChargeStatusStr").SetWidth(80).SetAlign(Align.center));
        if ((bool)ViewData["IsSampleApplyNeedTutorAudit"])
        {
            dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("导师审核情况", "TutorAuditStr").SetWidth(80).SetAlign(Align.center));
        }
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("送样时间", "ExpectSendDateStr").SetWidth(120).SetAlign(Align.left));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("备注信息", "Remark").SetWidth(120).SetAlign(Align.left));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("申请时间", "ApplyDateStr").SetWidth(120).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("期望完成时间", "ExpectResultDateStr").SetWidth(120).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("预计完成时间", "PredictResultTimeStr").SetWidth(120).SetAlign(Align.center));
        if ((bool)ViewData["IsNeedConfirmAcceptSample"])
        {
            dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("确认收样人", "AccepterName").SetWidth(100).SetAlign(Align.center));
            dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("确认收样时间", "AcceptDateStr").SetWidth(120).SetAlign(Align.center));
            dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("拒绝收样人", "RefuseAcceptOperaterName").SetWidth(100).SetAlign(Align.center));
            dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("拒绝收样时间", "RefuseAcceptDateStr").SetWidth(120).SetAlign(Align.center));
        }
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("设备名称", "EquipmentName").SetWidth(150).SetAlign(Align.left));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("价格", "Price").SetWidth(50).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("扣费金额", "Fee").SetWidth(80).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("取件方式", "GetResultWayName").SetWidth(100).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("完成时间", "FinishDateStr").SetWidth(120).SetAlign(Align.left));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("来样状态", "SmapleStatusName").SetWidth(100).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("其他", "SampleStatusReamrk").SetWidth(100).SetAlign(Align.left));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("审核人", "PasserName").SetWidth(100).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("审核时间", "PassDateStr").SetWidth(120).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("否决人", "RefuserName").SetWidth(100).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("否决时间", "RefuseDateStr").SetWidth(120).SetAlign(Align.center));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("课题组", "SubjectName").SetWidth(300).SetAlign(Align.left));
        dataGrid.AddColum(new com.Bynonco.JqueryEasyUI.Core.DataGridColumn("项目名称", "SubjectProjectName").SetWidth(300).SetAlign(Align.left));
      if (userPriviliges.IsEnableApply)
      {
          dataGrid.SetShowAddButton(true);
          dataGrid.SetAddScript("showSelectSampleBusinessTypeDialog('');return false;"); 
      }
      if (ViewData["SampleRoleStr"].ToString() == com.Bynonco.LIMS.Model.Enum.SampleRole.SampleTransactor.ToString())
      {
          if (userPriviliges.IsEnableAudit)
          {
              dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchAgree();return false;", IconCls = "icon-ok", Id = "btnBatchAgree", Text = "同意" });
              dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchRefuse();return false;", IconCls = "icon-no", Id = "btnBatchRefuse", Text = "否决" });
              
          }
      }
      if (ViewData["SampleRoleStr"].ToString() == com.Bynonco.LIMS.Model.Enum.SampleRole.SampleOfficer.ToString() && (bool)ViewData["IsNeedConfirmAcceptSample"])
      {
         
          if (userPriviliges.IsEnableAccept)
          {
              dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchAccept();return false;", IconCls = "icon-ok", Id = "btnBatchAccept", Text = "确认收样" });
          }
          if(userPriviliges.IsEnableRefuse)
          {
              dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchRefuseAccept();return false;", IconCls = "icon-no", Id = "btnBatchRefuseAccept", Text = "拒绝收样" });
          }
          if (userPriviliges.IsEnableReportConfirm)
          {
              dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchReportConfirm();return false;", IconCls = "icon-doc", Id = "btnBatchReportConfirm", Text = "已发报告" });
          }
      }
      dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchSendMsgNotice();return false;", IconCls = "icon-mail", Id = "btnBatchSendMsgNotice", Text = "发信" });
      dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "doBatchPringQrCode('tbSampleUnAutitList');return false;", IconCls = "icon-print", Id = "btnBatchPrintQrCode", Text = "二维码" });
      //dataGrid.AddToolBarButton(new ToolBarButton() { Handler = "showJatoolsPrinterInstall();return false;", IconCls = "icon-download", Id = "btnDownloadPrintQrCodePlug", Text = "打印插件" });
}
@(dataGrid.ToMvcString())